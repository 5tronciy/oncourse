databaseChangeLog:

  - changeSet:
      id: 105-1
      author: artyom
      preConditions:
        - onFail: HALT
        - and:
          - not:
            - columnExists:
                tableName: SessionCourseClassTutor
                columnName: startDatetime
            - columnExists:
                tableName: SessionCourseClassTutor
                columnName: endDatetime
      changes:
        - addColumn:
            tableName: SessionCourseClassTutor
            columns:
              - column:
                  name: startDatetime
                  type: DATETIME
              - column:
                  name: endDatetime
                  type: DATETIME
                  
  - changeSet:
      id: 105-2
      author: artyom
      preConditions:
        - onFail: HALT
        - and:
          - columnExists:
              tableName: SessionCourseClassTutor
              columnName: startDatetime
          - columnExists:
              tableName: SessionCourseClassTutor
              columnName: endDatetime
      changes:
        - sql: 'update SessionCourseClassTutor st
                join CourseSession s on st.sessionId = s.id
                set st.startDatetime = s.startDatetime, st.endDatetime = s.endDatetime;'
          
  - changeSet:
      id: 105-3
      author: artyom
      preConditions:
        - onFail: HALT
        - sqlCheck:
            expectedResult: 0
            sql: 'select count(*) from SessionCourseClassTutor where endDatetime is null or startDatetime is null'
      changes:
        - addNotNullConstraint:
            columnDataType: DATETIME
            columnName: startDatetime
            tableName: SessionCourseClassTutor
        - addNotNullConstraint:
            columnDataType: DATETIME
            columnName: endDatetime
            tableName: SessionCourseClassTutor
