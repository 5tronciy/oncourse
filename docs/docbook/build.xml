<?xml version="1.0"?>
<!--
====================================================
            Angel docbook build file
====================================================
-->
<project name="docbook" default="build" basedir=".">
	<import file="../../build.xml"/>

	<property name="manual.input" value="manual/oncourse-manual.xml"/>
	<property name="web.input" value="manual-web/website_administration.xml"/>
	<target name="clean">
		<delete dir="dist"/>
		<mkdir dir="dist/web"/>
		<mkdir dir="dist/manual"/>
	</target>

	<target name="html" description="Build the html documentation">
		<copy overwrite="true" preservelastmodified="true" todir="dist/manual/css/">
			<fileset dir="css"/>
		</copy>
		<copy overwrite="true" preservelastmodified="true" todir="dist/manual/images">
			<fileset dir="manual/images"/>
		</copy>
		<exec executable="xsltproc">
			<arg line="--output dist/manual/"/>
			<arg line="--xinclude"/>
			<arg line="stylesheets/html.xsl ${manual.input}"/>
		</exec>

		<copy overwrite="true" preservelastmodified="true" todir="dist/web/css/">
			<fileset dir="css"/>
		</copy>
		<copy overwrite="true" preservelastmodified="true" todir="dist/web/images">
			<fileset dir="manual-web/images"/>
		</copy>
		<exec executable="xsltproc">
			<arg line="--output dist/web/"/>
			<arg line="--xinclude"/>
			<arg line="stylesheets/html.xsl ${web.input}"/>
		</exec>
	</target>

	<target name="pdf" description="Build the pdf documentation">
		<exec executable="xsltproc">
			<arg line="--output dist/manual/oncourse-manual.fo"/>
			<arg line="--xinclude"/>
			<arg line="stylesheets/pdf.xsl ${manual.input}"/>
		</exec>
		<exec executable="fop">
			<arg line="-fo dist/manual/oncourse-manual.fo"/>
			<arg line="-pdf dist/manual/oncourse-manual.pdf"/>
		</exec>
		<delete file="dist/manual/oncourse-manual.fo"/>
		
		<exec executable="xsltproc">
			<arg line="--output dist/web/oncourse-web-manual.fo"/>
			<arg line="--xinclude"/>
			<arg line="stylesheets/pdf.xsl ${web.input}"/>
		</exec>
		<exec executable="fop">
			<arg line="-fo dist/web/oncourse-web-manual.fo"/>
			<arg line="-pdf dist/web/oncourse-web-manual.pdf"/>
		</exec>
		<delete file="dist/web/oncourse-web-manual.fo"/>
	</target>

	<target name="build" description="Build the pdf and html documentation" depends="pdf, html"/>

	<!--
	=================================
	target: upload-ftp
	=================================
	-->
	<!-- You have to call this target like this "ant -lib ../../lib/ant/commons-net.jar:../../lib/ant/jakarta-oro.jar upload" -->
	<target name="upload-ftp" description="This uploads the documentation to the ish web site">
		<fileset id="upload.files" dir="dist">
			<include name="**/*"/>
			<exclude name=".svn"/>
		</fileset>
		<ftp server="ftp.ish.com.au" userid="${ftpUser}" password="${ftpPass}" action="mkdir"
			remotedir="ish-static/onCourse/doc/${RELEASE_VERSION}"/>

		<ftp server="ftp.ish.com.au" userid="${ftpUser}" password="${ftpPass}" binary="yes"
			action="put" passive="yes" depends="yes"
			remotedir="ish-static/onCourse/doc/${RELEASE_VERSION}">
			<fileset refid="upload.files"/>
		</ftp>
	</target>
</project>
